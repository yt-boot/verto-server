# 前端应用开发管理平台 需求与设计说明（PRD）

- 文档版本：v1.0（草案）
- 更新时间：2025-11-03
- 适用范围：Web 端与 Electron 端
- 面向角色：产品经理、工程团队、运维、测试、管理者

## 一、背景与总体目标

组织希望通过统一平台实现前端应用的工程化治理、人员管控与资源沉淀，提升交付效率与线上质量。平台提供 Web 与 Electron 两种使用形态，支持内外网与本地环境结合。

总体目标：
- 工程化：标准化应用生命周期（创建/配置/构建/发布/回滚），打通仓库、分支、流水线、评审与多环境配置。
- 组件管理：沉淀物料（组件、模板、配置），建立版本与标签策略，提升复用率与质量门槛。
- 线上质量监控：建立前端质量指标、错误与性能监控、构建/发布稳定性看板与告警机制。

当前已完成的主要模块（verto-web）：
- 应用管理：`src/views/appmanage`
- 项目管理：`src/views/project`
- 人员管理：`src/views/staff`
- 积分管理：`src/views/points`
- 物料管理：`src/views/material`
- 开发工作台：`src/views/dashboard/devworkbench`

后端技术基座（verto-server）：基于 Jeecg-Boot 模块化，提供项目、应用、流水线、物料、人员、审计等服务能力（详见 `verto-server` 工程与 `docs/api-doc.md`).

---

## 二、应用使用场景与实际作用

典型使用场景：
1. 新建应用与模板初始化
   - 在平台中创建应用，选择模板进行快速初始化；绑定仓库（GitHub/GitLab），配置分支策略与流水线。
2. 一键构建发布与回滚
   - 开发者在工作台触发构建，流水线自动执行；运维管理员审批或自动发布；失败可快速回滚至最近稳定版本。
3. 代码评审与质量把关
   - 在应用或项目层设置评审规则与评审者；评审意见与结果沉淀；不达标的合并请求自动阻断。
4. 物料沉淀与复用
   - 组件与模板统一管理，版本/标签清晰；使用统计与贡献排行；新项目快速从模板与组件库搭建。
5. 人员管控与积分激励
   - 角色与权限分配，操作留痕；完成构建、评审、物料贡献自动计分，促进协作与质量提升。
6. 线上质量监控与告警
   - 前端错误与性能指标上报；构建/发布稳定性看板；异常自动告警与责任人通知；审计记录可追溯。

实际作用（对组织的价值）：
- 缩短应用交付周期，降低构建失败率，提升评审覆盖率与物料复用率；
- 强化发布合规与可回滚能力，降低线上风险；
- 通过积分激励与质量门禁，形成“工程化-复用-质量”闭环；
- 建立统一的运维与监控视角，提升问题定位与响应速度。

---

## 三、版本规划（分期目标）

本项目按“三期”实施，分别围绕：工程化、组件管理、线上质量监控。

### 一期：工程化（核心交付链路打通）

范围与目标：
- 应用生命周期：创建、模板初始化、配置、构建、发布、回滚。
- 仓库与分支：GitHub/GitLab绑定、分支策略（保护分支、合并策略）。
- 流水线：阶段配置、触发规则、环境变量、构建脚本，构建历史与日志。
- 评审：基础评审规则与流程、评审记录。
- 配置中心：变量、触发、阶段、通知与审批基础能力。
- 人员与权限：RBAC 初版、角色分配、审计基础留痕。

可交付与接口：
- 前端已存在视图对齐与完善：
  - `appmanage`（应用信息、模板初始化、流水线、菜单/页面、评审、统计）
  - `project`（项目配置、成员管理、流水线视图、构建历史、分支管理）
  - `dashboard/devworkbench`（仓库绑定卡片、动态信息、快捷入口）
- 后端 API：`/api/app`、`/api/project`、`/api/pipeline`、`/api/review`、`/api/integration` 等；统一返回格式与错误码（详见 `docs/api-doc.md`）。

验收标准：
- 新建应用可从模板完成初始化；构建-发布-回滚链路可用，失败日志可查；
- 分支策略与评审规则生效，评审记录可查询；
- 配置中心变量与触发规则可配置并生效；
- 基础审计记录覆盖敏感操作。

KPIs（示例）：
- 应用创建与上线周期缩短≥30%
- 构建失败率下降≥20%
- 评审覆盖率≥80%

### 二期：组件管理（物料沉淀与复用）

范围与目标：
- 组件库与模板库：清单、版本、标签、依赖关系、示例与文档；
- 发布流程：组件发布规范、变更日志、质量门禁（lint/test 基线）；
- 复用统计：使用次数、影响范围、贡献者排行；
- 模板治理：模板分类、适用场景、初始化向导与参数化生成。

可交付与接口：
- 前端视图完善：
  - `material/component`（组件管理、TagVersionManager、README 指引）
  - `material/template`（模板管理与初始化流程）
- 后端 API：`/api/material`（组件/模板/版本/标签/依赖/统计），支持检索与权限控制。

验收标准：
- 组件与模板的版本/标签管理完备；
- 发布流程具备质量门槛（最低 lint/test 基线）；
- 复用统计可视化，贡献记录清晰；
- 新项目可通过模板与组件库快速搭建。

KPIs（示例）：
- 物料复用率≥60%
- 组件发布失败率≤5%
- 文档覆盖率≥90%

### 三期：线上质量监控（可观测与风险控制）

范围与目标：
- 前端质量指标：错误上报（JS错误、Promise拒绝、资源加载失败）、性能指标（FCP、LCP、CLS、TTI、TTFB）。
- 构建/发布稳定性：成功率、耗时分布、失败原因分类；看板与趋势分析。
- 告警与通知：错误与性能异常、构建失败、评审超时的自动告警；责任人通知与值班策略。
- 审计与合规：权限变更、敏感操作、数据导入导出留痕；日志留存策略。

可交付与接口：
- 前端 SDK/埋点方案与配置页；质量看板视图（可整合 `dashboard`）。
- 后端 API：`/api/quality`、`/api/audit`、`/api/alert`；与现有 `/api/pipeline`、`/api/project` 融合呈现可视化。

验收标准：
- 错误与性能指标具备采集、存储、查询与可视化；
- 告警策略可配置并验证可达；
- 审计覆盖关键操作，报表可导出。

KPIs（示例）：
- 线上 P1 问题平均定位时间缩短≥40%
- 前端核心性能指标达标率≥85%
- 告警到响应时间≤10分钟（工作时段）

---

## 四、角色与权限（RBAC）

- 超级管理员：系统配置、租户管理、全局规则、权限分配、审计查看。
- 运维管理员：应用与流水线配置、构建发布、回滚、环境与变量管理。
- 项目负责人：项目配置、成员管理、评审规则管理、应用创建。
- 评审者：评审读写、评审结果提交、质量把关。
- 开发者：应用读取、触发构建、物料贡献、提交评审请求。
- 普通成员：只读访问（按授权范围）、积分查看。

---

## 五、信息架构与导航（前端）

- 一级导航：工作台、应用、项目、物料、人员、积分、配置中心、系统设置。
- 二级导航：各模块的列表/详情/配置/历史/统计。
- 搜索与过滤：全局搜索、模块内过滤与排序。
- 通知与提醒：构建状态、评审请求、积分变更、系统公告。

对应代码目录（verto-web）：
- `src/views/appmanage`、`src/views/project`、`src/views/staff`、`src/views/points`、`src/views/material`、`src/views/dashboard/devworkbench`。

---

## 六、技术架构与环境

- 前端：Vue3 + Vite + TS + Ant Design Vue + qiankun 微前端；Electron 桌面端（IPC、打包）。
- 后端：Jeecg-Boot 模块化，MySQL；网关与容器化部署。
- 配置与环境：`.env.*` 多环境；构建期变量注入（参考 `verto-web/build/utils.ts` 与 `vite.config.ts`）。
- 部署：Web（Docker/Nginx/网关），Electron（electron-builder 与自动更新策略）。

---

## 七、数据模型（核心实体）

- Application：id、name、projectId、repoUrl、templateId、ownerId、visibility、status、configs、pipelines。
- Project：id、name、description、ownerId、members、branchStrategy、repos。
- Pipeline：id、appId、stages、triggers、envs、buildScript、status。
- BuildRecord：id、pipelineId、commitId、branch、startTime、endTime、status、logUrl。
- Material：id、type（component/template）、name、version、tags、author、usageCount。
- Staff：id、name、email、role、status、teams、pointsTotal。
- PointsTransaction：id、staffId、reason、delta、time、approverId。
- Review：id、appId/projectId、reviewers、rules、result、comments、time。
- AuditLog：id、actorId、action、resourceId、resourceType、time、metadata。

---

## 八、非功能性需求

- 性能：首屏≤2s（内网），操作响应≤300ms，列表分页与虚拟滚动。
- 安全：RBAC、审计留痕、令牌与会话管理、CSRF/XSS 防护、敏感信息加密。
- 可用性：构建失败重试、发布回滚机制；Electron 离线可用（缓存）。
- 可靠性：任务容错与幂等；前端异常监控与上报。
- 可维护性：模块化与微前端；配置化驱动与环境隔离。

---

## 九、测试与验收

- 单元测试：关键逻辑与工具函数覆盖率≥70%。
- 集成测试：主要业务流程与接口契约测试。
- 端到端测试：应用创建→构建→评审→发布→回滚全链路。
- 性能与稳定性测试：并发访问、构建任务压力。

验收重点：
- 一期：工程化链路打通与可回滚；评审与分支策略生效；配置中心可用。
- 二期：组件/模板版本标签与发布规范；复用统计与贡献可视化。
- 三期：质量指标采集、看板与告警；审计覆盖与报表导出。

---

## 十、里程碑与计划（示例）

- M1（一期-工程化）：4-6周
  - 联调后端接口、完善视图与交互、完成构建发布回滚链路与评审基础。
- M2（二期-组件管理）：4周
  - 组件/模板版本与标签、发布规范与质量门槛、复用统计与文档化。
- M3（三期-线上质量监控）：4-6周
  - 前端质量指标采集与看板、告警与通知、审计与合规完善。

---

## 十一、风险与依赖

- 风险：接口变更导致前端不稳定；环境变量与配置不一致；权限误配造成访问异常。
- 依赖：Jeecg-Boot 与数据库脚本；GitHub/GitLab 集成（Token 与权限）；容器与网关；Electron 打包与更新服务。

---

## 十二、补充建议

- 尽快明确 `.env.*` 到构建期与运行期变量的安全策略，避免敏感信息暴露到前端运行时；
- 仓库绑定卡片增加令牌过期与异常提示；
- 积分规则与审批策略细化，并明确积分的外部作用（如兑换、晋级参考）；
- 质量监控看板建议与流水线/发布记录关联，实现问题定位闭环。

> 说明：本文档为草案，可随开发进度在 `verto-server/docs` 中版本化维护（如 `prd-app-management-platform-v1.1.md`）。